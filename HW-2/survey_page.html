<!--Akshath Phillips SWE 642-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CS Department Survey</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #f8f9fa;
      color: #006633; /* gmu-green */
      font-family: "Montserrat", sans-serif
    }

    .gmu-yellow {
      color: #FFCC33;
    }

    .gmu-green {
      color: #006633;
    }

    .required-label::after {
      content: " *";
      color: red;
    }

    h1 {
      color: #006633;
    }
  </style>
</head>
<body>

<!-- Bootstrap Navigation Bar -->
<nav class="navbar navbar-expand-md bg-dark sticky-top border-bottom" data-bs-theme="dark">
  <div class="container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-navbar"
            aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="main-navbar">
      <div class="offcanvas-body">
        <ul class="navbar-nav flex-grow-1 justify-content-around">
          <li class="nav-item"><a class="nav-link" href="./index.html">Class Page</a></li>
          <li class="nav-item">
            <a class="navbar-brand" href="./survey_page.html">Akshath Phillips | SWE 642</a>
          </li>
          <li class="nav-item"><a class="nav-link" href="./department_page.html">CS Department</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<div class="container pt-2 p-5">
  <div class="gmu-green">
    <h3>
      <span id="day-greeting"></span>
      <span id="name-greeting"></span><a class="small" href="#change-name">(Not you?)</a>
      Welcome to SWE642 survey!</h3>
    <p>We value your feedback about your campus visit. Please fill out the survey below:</p>
  </div>
  <h1 class="gmu-green">Survey</h1>

  <form class="needs-validation" novalidate>
    <div class="mb-3">
      <label for="username" class="form-label required-label">Username</label>
      <input type="text" class="form-control" id="username" required placeholder="Example: John Doe 123">
      <div class="invalid-feedback">
        Please provide a username.
      </div>
    </div>

    <div class="mb-3">
      <label for="address" class="form-label required-label">Street Address</label>
      <input type="text" class="form-control" id="address" required placeholder="Example: 123 Fairfax St">
      <div class="invalid-feedback">
        Please provide a street address.
      </div>
    </div>

    <div class="row">
      <div class="col-md-6 mb-3">
        <label for="city" class="form-label required-label">City</label>
        <input type="text" class="form-control" id="city" required placeholder="Example: Fairfax">
        <div class="invalid-feedback">
          Please provide a city.
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <label for="state" class="form-label required-label">State</label>
        <input type="text" class="form-control" id="state" required placeholder="Example: VA">
        <div class="invalid-feedback">
          Please provide a state.
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <label for="zip" class="form-label required-label">Zip</label>
        <input type="text" class="form-control" id="zip" required placeholder="Example: 22102">
        <div class="small p-2">
          The following zip codes are auto completed.
          <div>
            22312, 22030, 22301, and 20148.
          </div>
        </div>
        <div class="invalid-feedback">
          Please provide a zip code.
        </div>
      </div>
    </div>
    <div class="mb-3">
      <label for="telephone" class="form-label">Telephone Number</label>
      <input type="tel" class="form-control" id="telephone" placeholder="Example: (123) 456-7890">
    </div>

    <div class="mb-3">
      <label for="email" class="form-label required-label">Email</label>
      <input type="email" class="form-control" id="email" required placeholder="Example: johndoe@gmu.edu">
      <div class="invalid-feedback">
        Please provide a valid email address.
      </div>
    </div>

    <div class="mb-3">
      <label for="url" class="form-label">Website URL</label>
      <input type="url" class="form-control" id="url" placeholder="Example: https://www.gmu.edu">
    </div>

    <div class="mb-3">
      <label for="survey-date" class="form-label">Date of Survey</label>
      <input type="date" class="form-control" id="survey-date">
    </div>

    <div class="mb-3">
      <label class="form-label required-label">What did you like most about the campus?</label>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="liked-campus-students" required>
        <label class="form-check-label" for="liked-campus-students">Students</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="liked-location" required>
        <label class="form-check-label" for="liked-location">Location</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="liked-campus" required>
        <label class="form-check-label" for="liked-campus">Campus</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="liked-campus-atmosphere" required>
        <label class="form-check-label" for="liked-campus-atmosphere">Atmosphere</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="liked-campus-dorms" required>
        <label class="form-check-label" for="liked-campus-dorms">Dorm Rooms</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="liked-campus-sports" required>
        <label class="form-check-label" for="liked-campus-sports">Sports</label>
      </div>
      <div class="invalid-feedback">
        Please select at least two checkboxes.
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label required-label">How did you become interested in the university?</label>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="interest" id="interest-friends" required>
        <label class="form-check-label" for="interest-friends">Friends</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="interest" id="interest-television" required>
        <label class="form-check-label" for="interest-television">Television</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="interest" id="interest-internet" required>
        <label class="form-check-label" for="interest-internet">Internet</label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="interest" id="interest-other" required>
        <label class="form-check-label" for="interest-other">Other</label>
      </div>
      <div class="invalid-feedback">
        Please select a radio button option.
      </div>
    </div>

    <div class="mb-3">
      <label for="comments" class="form-label">Additional Comments</label>
      <textarea class="form-control" id="comments" rows="4"
                placeholder="Example: Your feedback is important to us."></textarea>
    </div>

    <div class="mb-3">
      <label for="graduation-month" class="form-label">High School Graduation Month</label>
      <input list="graduation-months" class="form-control" id="graduation-month" placeholder="Example: January">
      <datalist id="graduation-months">
        <option value="January">
        <option value="February">
        <option value="March">
        <option value="April">
        <option value="May">
        <option value="June">
        <option value="July">
        <option value="August">
        <option value="September">
        <option value="October">
        <option value="November">
        <option value="December">
      </datalist>
    </div>

    <div class="mb-3">
      <label for="graduation-year" class="form-label">High School Graduation Year</label>
      <input type="text" class="form-control" id="graduation-year" placeholder="Example: 2023">
    </div>

    <div class="mb-3">
      <label for="likelihood" class="form-label">Likelihood of Recommending</label>
      <select class="form-select" id="likelihood">
        <option value="Very Likely">Very Likely</option>
        <option value="Likely">Likely</option>
        <option value="Unlikely">Unlikely</option>
      </select>
    </div>

    <div class="mb-3">
      <label for="data" class="form-label required-label">Data</label>
      <input type="text" class="form-control" id="data" required
             placeholder="Enter 10 comma-separated numbers between 1 and 100">
      <div class="invalid-feedback">
        Please provide 10 comma-separated numbers between 1 and 100.
      </div>
    </div>

    <div class="mb-3">
      <label for="average-output" class="form-label">Average</label>
      <output id="average-output"></output>
    </div>

    <div class="mb-3">
      <label for="maximum-output" class="form-label">Maximum</label>
      <output id="maximum-output"></output>
    </div>

    <div class="mt-4">
      <button type="submit" class="btn btn-success gmu-yellow" style="background-color: #006633;">Submit</button>
      <button type="reset" class="btn btn-secondary">Reset</button>
    </div>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

<script>
  /*Autofill current date*/
  const currentDate = new Date();
  const formattedDate = currentDate.toISOString().split('T')[0];
  document.getElementById('survey-date').value = formattedDate;

  /*Username focus*/
  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("username").focus();
  });

  function validateForm(event) {
    const form = event.target;

    // Remove previous validation states
    form.classList.remove('was-validated');

    // Lets collect all the errors to display as an alert
    const errors = [];

    // Name
    const usernameInput = document.getElementById('username');
    const username = usernameInput.value;
    const namePattern = /^[a-zA-Z\s]+$/;
    if (!namePattern.test(username)) {
      errors.push("Name should contain only alphabets.");
      usernameInput.classList.add('is-invalid');
    } else {
      usernameInput.classList.remove('is-invalid');
    }

    // Address
    const addressInput = document.getElementById('address');
    const address = addressInput.value;
    const addressPattern = /^[a-zA-Z0-9\s,.'-]+$/;
    if (!addressPattern.test(address)) {
      errors.push("Address should contain appropriate characters.");
      addressInput.classList.add('is-invalid');
    } else {
      addressInput.classList.remove('is-invalid');
    }

    // City
    const cityInput = document.getElementById('city');
    const city = cityInput.value;
    const cityPattern = /^[a-zA-Z\s]+$/;
    if (!cityPattern.test(city)) {
      errors.push("City should contain only alphabets.");
      cityInput.classList.add('is-invalid');
    } else {
      cityInput.classList.remove('is-invalid');
    }

    // State
    const stateInput = document.getElementById('state');
    const state = stateInput.value;
    const statePattern = /^[a-zA-Z\s]+$/;
    if (!statePattern.test(state)) {
      errors.push("State should contain only alphabets.");
      stateInput.classList.add('is-invalid');
    } else {
      stateInput.classList.remove('is-invalid');
    }

    // Zip
    const zipInput = document.getElementById('zip');
    const zip = zipInput.value;
    const zipPattern = /^\d{5}$/;
    if (!zipPattern.test(zip)) {
      errors.push("Zip should be 5 digits.");
      zipInput.classList.add('is-invalid');
    } else {
      zipInput.classList.remove('is-invalid');
    }

    // Email
    const emailInput = document.getElementById('email');
    const email = emailInput.value;
    const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    if (!emailPattern.test(email)) {
      errors.push("Please provide a valid email address.");
      emailInput.classList.add('is-invalid');
    } else {
      emailInput.classList.remove('is-invalid');
    }

    // Checkboxes. At-least 2
    const checkboxes = form.querySelectorAll('input[type="checkbox"]');
    const checkedCheckboxes = Array.from(checkboxes).filter(cb => cb.checked);
    if (checkedCheckboxes.length < 2) {
      errors.push("Please select at least two checkboxes.");
      checkboxes.forEach(checkbox => {
        checkbox.classList.add('is-invalid');
      });
    } else {
      checkboxes.forEach(checkbox => {
        checkbox.classList.remove('is-invalid');
      });
    }

    // Radio button, at-least 1
    const radioButtons = form.querySelectorAll('input[type="radio"]');
    const checkedRadio = Array.from(radioButtons).some(rb => rb.checked);
    if (!checkedRadio) {
      errors.push("Please select a radio button.");
      radioButtons.forEach(radioButton => {
        radioButton.classList.add('is-invalid');
      });
    } else {
      radioButtons.forEach(radioButton => {
        radioButton.classList.remove('is-invalid');
      });
    }

    // Data
    const dataInput = document.getElementById('data');
    const data = dataInput.value;
    const dataPattern = /^(\d{1,2}(,\s*\d{1,2}){9})$/;
    if (!dataPattern.test(data)) {
      errors.push("Please provide 10 comma-separated numbers between 1 and 100.");
      dataInput.classList.add('is-invalid');
    } else {
      dataInput.classList.remove('is-invalid');
    }


    // Check if there are validation errors
    if (errors.length > 0) {
      event.preventDefault();

      // Display all validation errors
      const errorMessages = errors.join('\n');
      alert(errorMessages);
    } else {
      // If all validations pass, show a success message and reset the form
      alert("Thank you for submitting the form. Your feedback has been received.");
      form.reset();
    }
  }

  const forms = document.querySelectorAll('.needs-validation');
  Array.prototype.slice.call(forms).forEach(function (form) {
    form.addEventListener('submit', validateForm, false);
  });

  /*Cookies*/
  function setCookie(name, value) {
    const expires = new Date();
    expires.setTime(expires.getTime() + (60 * 1000));
    document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
  }

  function getCookie(name) {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.startsWith(name + '=')) {
        return cookie.substring(name.length + 1);
      }
    }
    return null;
  }

  function displayGreeting(name) {
    const currentDate = new Date();
    const currentHour = currentDate.getHours();
    let greeting = '';

    if (currentHour >= 5 && currentHour < 12) {
      greeting = 'Good morning';
    } else if (currentHour >= 12 && currentHour < 18) {
      greeting = 'Good afternoon';
    } else {
      greeting = 'Good evening';
    }

    document.getElementById('day-greeting').textContent =
      `${greeting}`;
    document.getElementById('name-greeting').textContent =
      `${name}! `;

  }

  // Cookie main runner
  const userName = getCookie('userName');
  if (userName) {
    displayGreeting(userName);

    // Click event handler to the "Not you?" link
    const changeNameLink = document.querySelector('a[href="#change-name"]');
    if (changeNameLink) {
      changeNameLink.addEventListener('click', function (event) {
        event.preventDefault();
        const newName = prompt('Please enter your new name:');
        if (newName) {
          setCookie('userName', newName);
          displayGreeting(newName);
        }
      });
    }
  } else {
    const name = prompt('Please enter your name:');
    if (name) {
      setCookie('userName', name);
      displayGreeting(name);
    }
  }

  // Calculate Average and Maximum
  function calculate() {
    const dataInput = document.getElementById('data');
    const averageOutput = document.getElementById('average-output');
    const maximumOutput = document.getElementById('maximum-output');

    const data = dataInput.value.split(',').map(Number);

    if (data.length !== 10 || data.some(num => isNaN(num) || num < 1 || num > 100)) {
      dataInput.setCustomValidity('Please provide 10 comma-separated numbers between 1 and 100.');
      averageOutput.textContent = '';
      maximumOutput.textContent = '';
    } else {
      dataInput.setCustomValidity('');
      const average = data.reduce((acc, val) => acc + val, 0) / data.length;
      const maximum = Math.max(...data);
      averageOutput.textContent = `Average: ${average.toFixed(2)}`;
      maximumOutput.textContent = `Maximum: ${maximum}`;
    }
  }

  // On Blur
  document.getElementById('data').addEventListener('blur', calculate);

  document.addEventListener("DOMContentLoaded", function () {
    const zipcodeInput = document.getElementById("zip");
    const cityInput = document.getElementById("city");
    const stateInput = document.getElementById("state");

    zipcodeInput.addEventListener("blur", function () {
      const enteredZip = zipcodeInput.value;

      // Make an Ajax call to get the JSON data
      fetch("https://gmu-swe-642-aphill5-hw2.s3.amazonaws.com/zipcodes.json")
        .then((response) => response.json())
        .then((data) => {
          const matchingZipcode = data['zipcodes'].find((zipcode) => zipcode['zip'] === enteredZip);

          if (matchingZipcode) {
            cityInput.value = matchingZipcode['city'];
            stateInput.value = matchingZipcode['state'];
          } else {
            cityInput.value = "";
            stateInput.value = "";
          }
        })
        .catch((error) => {
          console.error("Error fetching data: " + error);
        });
    });
  });

</script>

</body>
</html>
